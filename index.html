<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¦¬ë“¬ê²Œì„</title>
  <style>
  :root { --max-width: 900px; }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    display: flex; flex-direction: column; align-items: center;
    padding: 16px;
  }
  h1 { margin: 12px 0 8px; font-size: clamp(18px, 4vw, 28px); }
  .bar { width: 100%; max-width: var(--max-width); display:flex; justify-content:center; gap:12px; margin-bottom: 12px; }
  button { font-size: clamp(14px, 3.8vw, 18px); padding: 10px 16px; border-radius: 10px; border: 1px solid #ccc; background:#fff; }
  #content { width: 100%; max-width: var(--max-width); }
  /* ìº”ë²„ìŠ¤ëŠ” ëª¨ë°”ì¼ ìš°ì„ : í­ ê°€ë“, ë†’ì´ëŠ” ë¹„ìœ¨ ìœ ì§€(600:400=3:2) */
  canvas {
    width: 100%;
    /* í™”ë©´ì´ ë„ˆë¬´ ë†’ê²Œ ì°¨ì§€í•˜ì§€ ì•Šë„ë¡ ìƒí•œ: ëª¨ë°”ì¼ 70vh, ë°ìŠ¤í¬íƒ‘ 60vh */
    max-height: 70vh;
    display: block; margin: 0 auto; border: 1px solid #000;
    touch-action: manipulation;
  }
  p { margin: 8px 0; font-size: clamp(14px, 3.6vw, 16px); text-align:center; }
</style>

</head>
<body>
  <h1>ğŸµ ë¦¬ë“¬ê²Œì„ ğŸµ</h1>
  <button onclick="startGame()">ê²Œì„ ì‹œì‘</button>
  <button onclick="showRanking()">ë­í‚¹ í™•ì¸</button>

  <div id="content"></div>

<script>
  // ====== ì „ì—­ ìƒíƒœ ======
  let gameArea, ctx;
  let score = 0;
  let circles = [];
  let gameInterval;

  // ë…¼ë¦¬ ì¢Œí‘œ(ë””ìì¸ í•´ìƒë„) â€” ê²Œì„ ë¡œì§ì€ ì´ ì¢Œí‘œê³„ë¥¼ ê¸°ì¤€ìœ¼ë¡œë§Œ ë™ì‘
  const DESIGN_W = 600;
  const DESIGN_H = 400;

  // íŒì • ìƒìˆ˜
  const TARGET = 70;
  const PERFECT_MIN = 60;
  const PERFECT_MAX = 80;

  // ë·°(ìŠ¤í¬ë¦° ìŠ¤ì¼€ì¼/ì˜¤í”„ì…‹) ìƒíƒœ
  const view = {
    cssW: 0, cssH: 0,        // CSS í”½ì…€(ë³´ì´ëŠ” í¬ê¸°)
    dpr: 1,                  // ë””ë°”ì´ìŠ¤ í”½ì…€ ë¹„ìœ¨
    scale: 1,                // ë…¼ë¦¬ì¢Œí‘œâ†’í™”ë©´ ìŠ¤ì¼€ì¼
    offsetX: 0, offsetY: 0   // ë ˆí„°ë°•ìŠ¤ ë³´ì •
  };

  // ====== ë¦¬ì‚¬ì´ì¦ˆ & ìŠ¤ì¼€ì¼ë§ ======
  function resizeCanvas() {
    if (!gameArea || !ctx) return;

    // 1) CSS í¬ê¸° ê²°ì • (ëª¨ë°”ì¼ ìš°ì„ )
    // í­ì€ ì»¨í…Œì´ë„ˆ ê°€ë“, ë†’ì´ëŠ” 3:2 ë¹„ìœ¨ ìœ ì§€. ë‹¨, 70vh(ëª¨ë°”ì¼)/60vh(ë°ìŠ¤í¬íƒ‘) ìƒí•œ.
    const container = gameArea.parentElement;
    const containerW = container.clientWidth;

    const aspect = DESIGN_H / DESIGN_W; // 400/600 = 0.666...
    let cssW = containerW;
    let cssH = Math.round(cssW * aspect);

    const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
    const maxH = (window.innerWidth < 768) ? Math.round(vh * 0.70) : Math.round(vh * 0.60);
    if (cssH > maxH) {
      cssH = maxH;
      cssW = Math.round(cssH / aspect);
    }

    view.cssW = cssW;
    view.cssH = cssH;

    // 2) ì‹¤ì œ ìº”ë²„ìŠ¤ í”½ì…€ í¬ê¸° (DPR ë°˜ì˜, ë ˆí‹°ë‚˜ ì„ ëª…ë„)
    const dpr = window.devicePixelRatio || 1;
    view.dpr = dpr;
    gameArea.style.width = cssW + "px";
    gameArea.style.height = cssH + "px";
    gameArea.width = Math.round(cssW * dpr);
    gameArea.height = Math.round(cssH * dpr);

    // 3) ë…¼ë¦¬ì¢Œí‘œ â†’ í™”ë©´ ìŠ¤ì¼€ì¼/ì˜¤í”„ì…‹ ê³„ì‚° (ë ˆí„°ë°•ìŠ¤ ëŒ€ì‘)
    const scaleX = cssW / DESIGN_W;
    const scaleY = cssH / DESIGN_H;
    view.scale = Math.min(scaleX, scaleY);
    view.offsetX = (cssW - DESIGN_W * view.scale) / 2;
    view.offsetY = (cssH - DESIGN_H * view.scale) / 2;

    // 4) ì¢Œí‘œê³„ ì ìš©
    applyViewTransform();
    // í”„ë ˆì„ ì¦‰ì‹œ ê°±ì‹ (ê¹œë¹¡ì„ ë°©ì§€)
  }

  function applyViewTransform() {
    // í™”ë©´ í”½ì…€ ì¢Œí‘œê³„ë¡œ ì´ˆê¸°í™” í›„, DPR+ìŠ¤ì¼€ì¼+ì˜¤í”„ì…‹ ì ìš©
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    // ì „ì²´ í´ë¦¬ì–´ëŠ” updateGameì—ì„œ ìˆ˜í–‰
    // ë³€í™˜ ì ìš©: (ìŠ¤ì¼€ì¼*DPR)ê³¼ (ì˜¤í”„ì…‹*DPR)
    ctx.setTransform(view.scale * view.dpr, 0, 0, view.scale * view.dpr,
                     view.offsetX * view.dpr, view.offsetY * view.dpr);
  }

  function clearFrame() {
    // í™”ë©´ í”½ì…€ ê¸°ì¤€ìœ¼ë¡œ ì™„ì „ í´ë¦¬ì–´
    ctx.save();
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.clearRect(0, 0, gameArea.width, gameArea.height);
    ctx.restore();
    // ë‹¤ì‹œ ë…¼ë¦¬ì¢Œí‘œ ë³€í™˜ ì ìš©
    applyViewTransform();
  }

  // ====== ê²Œì„ ë£¨í”„ ======
  function updateGame() {
    clearFrame();

    // ì„  ë‘ê»˜/ê¸€ê¼´ì„ ë…¼ë¦¬ì¢Œí‘œ ê¸°ì¤€ìœ¼ë¡œ ì¼ì •í•˜ê²Œ ë³´ì´ê²Œ ì¡°ì •(ì˜µì…˜)
    // í™”ë©´ ìŠ¤ì¼€ì¼ì´ ì»¤ì§ˆìˆ˜ë¡ ì‹¤ì œ í™”ë©´ px ì„ ë‘ê»˜ê°€ ë‘êº¼ì›Œì§€ë‹ˆ ë³´ì •
    const lw = 1 / view.scale; // ë…¼ë¦¬ 1px ëŠë‚Œ
    ctx.lineWidth = lw;
    ctx.font = `${Math.max(10, Math.floor(12 / view.scale))}px sans-serif`;

    // ì› ì—…ë°ì´íŠ¸ & ê·¸ë¦¬ê¸°
    circles.forEach(c => {
      c.radius += 1; // ì†ë„ ê·¸ëŒ€ë¡œ

      // ì› (ê²€ì • ì‹¤ì„ )
      ctx.beginPath();
      ctx.setLineDash([]);
      ctx.strokeStyle = "black";
      ctx.arc(c.x, c.y, c.radius, 0, Math.PI * 2);
      ctx.stroke();

      // ë°˜ì§€ë¦„ í‘œê¸°
      ctx.fillText("r=" + Math.floor(c.radius), c.x + c.radius + 6, c.y);
    });

    // ê°€ì´ë“œ: í¼í™íŠ¸ ë²”ìœ„(60,80) + íƒ€ê¹ƒ(70)
    // í¼í™íŠ¸ ê²½ê³„(ì´ˆë¡ ì ì„ )
    ctx.setLineDash([6 / view.scale, 6 / view.scale]);
    ctx.strokeStyle = "green";

    ctx.beginPath();
    ctx.arc(300, 200, PERFECT_MIN, 0, Math.PI * 2);
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(300, 200, PERFECT_MAX, 0, Math.PI * 2);
    ctx.stroke();

    // íƒ€ê¹ƒ(ë¹¨ê°„ ì ì„ )
    ctx.setLineDash([10 / view.scale, 7 / view.scale]);
    ctx.strokeStyle = "red";
    ctx.beginPath();
    ctx.arc(300, 200, TARGET, 0, Math.PI * 2);
    ctx.stroke();

    // ë‹¤ìŒ í”„ë ˆì„
    requestAnimationFrame(updateGame);
  }

  // ====== ì…ë ¥ ======
  function checkHit(event) {
    if (event.code !== "Space") return;
    if (circles.length === 0) return;

    const c = circles[0];
    const r = c.radius;
    let gained = 0;

    if (r > PERFECT_MIN && r < PERFECT_MAX) {
      gained = 100;                // 60 < r < 80
    } else if (Math.abs(r - TARGET) < 25) {
      gained = 50;                 // íƒ€ê²Ÿ Â±25
    } else {
      gained = 10;
    }

    score += gained;
    document.getElementById("score").innerText = score;
    circles.shift(); // ì‚¬ìš©í•œ ì› ì œê±°
  }

  // ====== í™”ë©´ êµ¬ì„± ======
  function startGame() {
    document.getElementById("content").innerHTML = `
      <p>í•™ë²ˆ: <input id="studentId"></p>
      <p>ì´ë¦„: <input id="name"></p>
      <div class="bar"><button onclick="gameStart()">ì…ë ¥ ì™„ë£Œ</button></div>
    `;
  }

  function gameStart() {
    const id = (document.getElementById("studentId").value || "").trim();
    const name = (document.getElementById("name").value || "").trim();

    document.getElementById("content").innerHTML = `
      <canvas id="gameCanvas"></canvas>
      <p>ì ìˆ˜: <span id="score">0</span></p>
      <p>${id} ${name} ë‹˜, ìŒì•…ì— ë§ì¶° í‚¤ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”! (ìŠ¤í˜ì´ìŠ¤ë°”)</p>
    `;

    gameArea = document.getElementById("gameCanvas");
    ctx = gameArea.getContext("2d");

    // ì´ˆê¸° ì› ìƒì„± ì£¼ê¸°(2ì´ˆ)
    gameInterval = setInterval(createCircle, 2000);

    // ë¦¬ì‚¬ì´ì¦ˆ ì ìš© ë° ë£¨í”„ ì‹œì‘
    resizeCanvas();
    requestAnimationFrame(updateGame);

    // ì…ë ¥ ë“±ë¡
    document.addEventListener("keydown", checkHit, { passive: true });

    // ì°½ í¬ê¸°/íšŒì „ ë³€ê²½ ì‹œ ë°˜ì‘
    window.addEventListener("resize", resizeCanvas);
    window.addEventListener("orientationchange", () => {
      // ëª¨ë°”ì¼ íšŒì „ ì¦‰ì‹œ ë°˜ì˜
      setTimeout(resizeCanvas, 50);
    });
  }

  // ====== ë°ì´í„° ======
  function createCircle() {
    // ë…¼ë¦¬ì¢Œí‘œ ê¸°ì¤€ ì¤‘ì•™
    circles.push({ x: 300, y: 200, radius: 10 });
  }

  function showRanking() {
    document.getElementById("content").innerHTML =
      `<p>ë­í‚¹ ê¸°ëŠ¥ì€ ì¶”í›„ ì¶”ê°€ ì˜ˆì •</p>`;
  }
</script>



</body>
</html>


