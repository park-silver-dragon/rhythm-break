<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¦¬ë“¬ê²Œì„</title>
  <style>
  :root { --max-width: 900px; }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    display: flex; flex-direction: column; align-items: center;
    padding: 16px;
  }
  h1 { margin: 12px 0 8px; font-size: clamp(18px, 4vw, 28px); }
  .bar { width: 100%; max-width: var(--max-width); display:flex; justify-content:center; gap:12px; margin-bottom: 12px; }
  button { font-size: clamp(14px, 3.8vw, 18px); padding: 10px 16px; border-radius: 10px; border: 1px solid #ccc; background:#fff; }
  #content { width: 100%; max-width: var(--max-width); }
  /* ìº”ë²„ìŠ¤ëŠ” ëª¨ë°”ì¼ ìš°ì„ : í­ ê°€ë“, ë†’ì´ëŠ” ë¹„ìœ¨ ìœ ì§€(600:400=3:2) */
  canvas {
    width: 100%;
    /* í™”ë©´ì´ ë„ˆë¬´ ë†’ê²Œ ì°¨ì§€í•˜ì§€ ì•Šë„ë¡ ìƒí•œ: ëª¨ë°”ì¼ 70vh, ë°ìŠ¤í¬íƒ‘ 60vh */
    max-height: 70vh;
    display: block; margin: 0 auto; border: 1px solid #000;
    touch-action: manipulation;
  }
  p { margin: 8px 0; font-size: clamp(14px, 3.6vw, 16px); text-align:center; }
</style>

</head>
<body>
  <h1>ğŸµ ë¦¬ë“¬ê²Œì„ ğŸµ</h1>
  <button onclick="startGame()">ê²Œì„ ì‹œì‘</button>
  <button onclick="showRanking()">ë­í‚¹ í™•ì¸</button>

  <div id="content"></div>

<script>
  // ====== ì „ì—­ ìƒíƒœ ======
  let gameArea, ctx;
  let score = 0;
  let circles = [];
  let gameInterval;

  // ë…¼ë¦¬ ì¢Œí‘œ(ë””ìì¸ í•´ìƒë„)
  const DESIGN_W = 600;
  const DESIGN_H = 400;

  // íŒì • ìƒìˆ˜
  const TARGET = 70;
  const PERFECT_MIN = 60;
  const PERFECT_MAX = 80;

  // í„°ì¹˜ íˆíŠ¸ë°•ìŠ¤ (ë…¼ë¦¬ ì¢Œí‘œ ê¸°ì¤€)
  const TOUCH_CENTER_X = 300;
  const TOUCH_CENTER_Y = 200;
  const TOUCH_HIT_RADIUS = 65; // ìš”ì²­ê°’

  // ë·°(ìŠ¤ì¼€ì¼ ìƒíƒœ)
  const view = {
    cssW: 0, cssH: 0,
    dpr: 1,
    scale: 1,
    offsetX: 0, offsetY: 0
  };

  // ====== ë¦¬ì‚¬ì´ì¦ˆ & ìŠ¤ì¼€ì¼ë§ ======
  function resizeCanvas() {
    if (!gameArea || !ctx) return;

    const container = gameArea.parentElement;
    const containerW = container.clientWidth;

    const aspect = DESIGN_H / DESIGN_W; // 400/600
    let cssW = containerW;
    let cssH = Math.round(cssW * aspect);

    const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
    const maxH = (window.innerWidth < 768) ? Math.round(vh * 0.70) : Math.round(vh * 0.60);
    if (cssH > maxH) {
      cssH = maxH;
      cssW = Math.round(cssH / aspect);
    }

    view.cssW = cssW;
    view.cssH = cssH;

    const dpr = window.devicePixelRatio || 1;
    view.dpr = dpr;
    gameArea.style.width = cssW + "px";
    gameArea.style.height = cssH + "px";
    gameArea.width = Math.round(cssW * dpr);
    gameArea.height = Math.round(cssH * dpr);

    const scaleX = cssW / DESIGN_W;
    const scaleY = cssH / DESIGN_H;
    view.scale = Math.min(scaleX, scaleY);
    view.offsetX = (cssW - DESIGN_W * view.scale) / 2;
    view.offsetY = (cssH - DESIGN_H * view.scale) / 2;

    applyViewTransform();
  }

  function applyViewTransform() {
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.setTransform(view.scale * view.dpr, 0, 0, view.scale * view.dpr,
                     view.offsetX * view.dpr, view.offsetY * view.dpr);
  }

  function clearFrame() {
    ctx.save();
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.clearRect(0, 0, gameArea.width, gameArea.height);
    ctx.restore();
    applyViewTransform();
  }

  // ====== ê³µìš© íŒì • ì²˜ë¦¬ ======
  function attemptHit() {
    if (circles.length === 0) return;
    const c = circles[0];
    const r = c.radius;
    let gained = 0;

    if (r > PERFECT_MIN && r < PERFECT_MAX) {
      gained = 100; // 60 < r < 80
    } else if (Math.abs(r - TARGET) < 25) {
      gained = 50;  // íƒ€ê²Ÿ Â±25
    } else {
      gained = 10;
    }

    score += gained;
    document.getElementById("score").innerText = score;
    circles.shift(); // ì‚¬ìš©í•œ ì› ì œê±°
  }

  // ====== ì…ë ¥: í‚¤ë³´ë“œ(PC í…ŒìŠ¤íŠ¸ìš©) ======
  function onKeyDown(e) {
    if (e.code !== "Space") return;
    attemptHit(); // í‚¤ë³´ë“œëŠ” íˆíŠ¸ë°•ìŠ¤ ì œí•œ ì—†ìŒ (ìš”ì²­ëŒ€ë¡œ ìœ ì§€)
  }

  // ====== ì…ë ¥: í„°ì¹˜/í´ë¦­(ëª¨ë°”ì¼ ìš°ì„ ) ======
  function screenToLogical(clientX, clientY) {
    const rect = gameArea.getBoundingClientRect();
    const cssX = clientX - rect.left;
    const cssY = clientY - rect.top;
    // CSS í”½ì…€ â†’ ë…¼ë¦¬ ì¢Œí‘œ (ì˜¤í”„ì…‹/ìŠ¤ì¼€ì¼ ë°˜ì˜, DPRì€ ì´ë¯¸ CSS ì¢Œí‘œë¡œ ë“¤ì–´ì˜´)
    const x = (cssX - view.offsetX) / view.scale;
    const y = (cssY - view.offsetY) / view.scale;
    return { x, y };
  }

  function onPointerDown(e) {
    // í•œ ì†ê°€ë½ë§Œ íŒì •
    const { x, y } = screenToLogical(e.clientX, e.clientY);
    const dx = x - TOUCH_CENTER_X;
    const dy = y - TOUCH_CENTER_Y;
    const dist = Math.hypot(dx, dy);

    // íˆíŠ¸ë°•ìŠ¤: ì¤‘ì‹¬ì—ì„œ r â‰¤ 65 ì•ˆìª½ì¼ ë•Œë§Œ íŒì • ì‹œë„
    if (dist <= TOUCH_HIT_RADIUS) {
      attemptHit();
    }
  }

  // ====== ê²Œì„ ë£¨í”„ ======
  function updateGame() {
    clearFrame();

    const lw = 1 / view.scale;
    ctx.lineWidth = lw;
    ctx.font = `${Math.max(10, Math.floor(12 / view.scale))}px sans-serif`;

    // ì› ì—…ë°ì´íŠ¸ & ê·¸ë¦¬ê¸°
    circles.forEach(c => {
      c.radius += 1; // ì†ë„ ê·¸ëŒ€ë¡œ
      ctx.beginPath();
      ctx.setLineDash([]);
      ctx.strokeStyle = "black";
      ctx.arc(c.x, c.y, c.radius, 0, Math.PI * 2);
      ctx.stroke();
      ctx.fillText("r=" + Math.floor(c.radius), c.x + c.radius + 6, c.y);
    });

    // í¼í™íŠ¸ ë²”ìœ„(ì´ˆë¡ ì ì„ )
    ctx.setLineDash([6 / view.scale, 6 / view.scale]);
    ctx.strokeStyle = "green";
    ctx.beginPath();
    ctx.arc(300, 200, PERFECT_MIN, 0, Math.PI * 2);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(300, 200, PERFECT_MAX, 0, Math.PI * 2);
    ctx.stroke();

    // íƒ€ê¹ƒ(ë¹¨ê°„ ì ì„ )
    ctx.setLineDash([10 / view.scale, 7 / view.scale]);
    ctx.strokeStyle = "red";
    ctx.beginPath();
    ctx.arc(300, 200, TARGET, 0, Math.PI * 2);
    ctx.stroke();

    requestAnimationFrame(updateGame);
  }

  // ====== í™”ë©´ êµ¬ì„± ======
  function startGame() {
    document.getElementById("content").innerHTML = `
      <p>í•™ë²ˆ: <input id="studentId"></p>
      <p>ì´ë¦„: <input id="name"></p>
      <div class="bar"><button onclick="gameStart()">ì…ë ¥ ì™„ë£Œ</button></div>
    `;
  }

  function gameStart() {
    const id = (document.getElementById("studentId").value || "").trim();
    const name = (document.getElementById("name").value || "").trim();

    document.getElementById("content").innerHTML = `
      <canvas id="gameCanvas"></canvas>
      <p>ì ìˆ˜: <span id="score">0</span></p>
      <p>${id} ${name} ë‹˜, ìŒì•…ì— ë§ì¶° í™”ë©´ ì¤‘ì•™ì—ì„œ í„°ì¹˜ ë˜ëŠ” ìŠ¤í˜ì´ìŠ¤ë°”! (ëª¨ë°”ì¼: í„°ì¹˜, PC: Space)</p>
    `;

    gameArea = document.getElementById("gameCanvas");
    ctx = gameArea.getContext("2d");

    gameInterval = setInterval(createCircle, 2000);
    resizeCanvas();
    requestAnimationFrame(updateGame);

    // ì…ë ¥ ë“±ë¡
    document.addEventListener("keydown", onKeyDown, { passive: true });
    gameArea.addEventListener("pointerdown", onPointerDown, { passive: true });

    // ë°˜ì‘í˜•
    window.addEventListener("resize", resizeCanvas);
    window.addEventListener("orientationchange", () => setTimeout(resizeCanvas, 50));
  }

  // ====== ë°ì´í„° ======
  function createCircle() {
    circles.push({ x: 300, y: 200, radius: 10 });
  }

  function showRanking() {
    document.getElementById("content").innerHTML = `<p>ë­í‚¹ ê¸°ëŠ¥ì€ ì¶”í›„ ì¶”ê°€ ì˜ˆì •</p>`;
  }
</script>



</body>
</html>



