<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¦¬ë“¬ê²Œì„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root { --max-width: 900px; }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      -webkit-text-size-adjust: 100%;
      background: #fff;
    }
    body { display: flex; flex-direction: column; align-items: center; padding: 16px; }

    /* íƒ€ì´í‹€ í¬ê²Œ */
    h1 {
      margin: 12px 0 10px; line-height: 1.2; font-weight: 800;
      font-size: clamp(24px, 7vw, 40px); letter-spacing: -0.02em; text-align: center;
    }

    /* ê³µìš© ë°” */
    .bar {
      width: 100%; max-width: var(--max-width);
      display: flex; justify-content: center; gap: 12px;
    }

    /* ë©”ì¸ ë©”ë‰´: ì¢Œìš° ë°°ì¹˜ + ë™ì¼ í­ */
    .bar.menu { flex-wrap: nowrap; }
    .bar.menu > button { flex: 1 1 0; min-width: 0; }

    /* ë²„íŠ¼ í¬ê²Œ + í„°ì¹˜ íƒ€ê¹ƒ í™•ë³´ */
    button {
      font-size: clamp(16px, 4.5vw, 18px);
      padding: 14px 18px; min-height: 48px;
      border-radius: 12px; border: 1px solid #d0d0d0; background:#fff;
      box-shadow: 0 1px 0 rgba(0,0,0,0.06); cursor: pointer;
    }
    button:active { transform: translateY(1px); }

    /* ì»¨í…ì¸  ì˜ì—­ */
    #content { width: 100%; max-width: var(--max-width); margin-top: 12px; }

    /* ì…ë ¥ UI */
    .input-row { display:flex; align-items:center; justify-content:center; gap:10px; margin: 10px 0; }
    label { font-size: clamp(15px, 4.2vw, 17px); }
    input[type="text"] {
      font-size: clamp(16px, 4.8vw, 18px);
      padding: 12px 14px; min-height: 48px;
      width: min(420px, 80vw);
      border: 1.2px solid #cfcfcf; border-radius: 10px; background: #fff;
    }

    /* ë³¸ë¬¸ í…ìŠ¤íŠ¸ */
    p { margin: 10px 0; font-size: clamp(15px, 4.2vw, 17px); text-align:center; }

    /* ìº”ë²„ìŠ¤ ë°˜ì‘í˜• */
    canvas {
      width: 100%; max-height: 70vh;
      display: block; margin: 0 auto; border: 1px solid #000;
      touch-action: manipulation;
    }

    @media (min-width: 1024px) {
      button { padding: 12px 16px; }
      input[type="text"] { width: 420px; }
      canvas { max-height: 60vh; }
    }
  </style>
</head>
<body>
  <h1>ğŸµ ë¦¬ë“¬ê²Œì„ ğŸµ</h1>

  <!-- ë©”ì¸ ë©”ë‰´: ì¢Œìš° ë°°ì¹˜ -->
  <div class="bar menu">
    <button onclick="startGame()">ê²Œì„ ì‹œì‘</button>
    <button onclick="showRanking()">ë­í‚¹ í™•ì¸</button>
  </div>

  <div id="content"></div>

  <script>
    // ====== ì „ì—­ ìƒíƒœ ======
    let gameArea, ctx;
    let score = 0;
    let circles = [];
    // let gameInterval; // ìë™ ìŠ¤í° ì œê±°ë¡œ ë¯¸ì‚¬ìš©

    // ë…¼ë¦¬ ì¢Œí‘œ(ë””ìì¸ í•´ìƒë„)
    const DESIGN_W = 600;
    const DESIGN_H = 400;

    // íŒì • ìƒìˆ˜ (ì ˆë°˜ ì„¸íŒ…)
    const TARGET = 35;
    const PERFECT_MIN = 30;
    const PERFECT_MAX = 40;

    // í„°ì¹˜ íˆíŠ¸ë°•ìŠ¤ (ë…¼ë¦¬ ì¢Œí‘œ ê¸°ì¤€, ì ˆë°˜ ì„¸íŒ…)
    const TOUCH_HIT_RADIUS = 33;

    // ë·°(ìŠ¤í¬ë¦° ìŠ¤ì¼€ì¼/ì˜¤í”„ì…‹) ìƒíƒœ
    const view = { cssW:0, cssH:0, dpr:1, scale:1, offsetX:0, offsetY:0 };

    // ====== ë¦¬ì‚¬ì´ì¦ˆ & ìŠ¤ì¼€ì¼ë§ ======
    function resizeCanvas() {
      if (!gameArea || !ctx) return;

      // 1) CSS í¬ê¸° ê²°ì • (ëª¨ë°”ì¼ ìš°ì„ , 3:2 ë¹„ìœ¨)
      const container = gameArea.parentElement;
      const containerW = container.clientWidth;
      const aspect = DESIGN_H / DESIGN_W; // 400/600
      let cssW = containerW;
      let cssH = Math.round(cssW * aspect);

      const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
      const maxH = (window.innerWidth < 768) ? Math.round(vh * 0.70) : Math.round(vh * 0.60);
      if (cssH > maxH) { cssH = maxH; cssW = Math.round(cssH / aspect); }

      view.cssW = cssW; view.cssH = cssH;

      // 2) ì‹¤ì œ ìº”ë²„ìŠ¤ í”½ì…€ í¬ê¸° (DPR ë°˜ì˜)
      const dpr = window.devicePixelRatio || 1;
      view.dpr = dpr;
      gameArea.style.width = cssW + "px";
      gameArea.style.height = cssH + "px";
      gameArea.width = Math.round(cssW * dpr);
      gameArea.height = Math.round(cssH * dpr);

      // 3) ìŠ¤ì¼€ì¼/ì˜¤í”„ì…‹ ê³„ì‚°
      const scaleX = cssW / DESIGN_W;
      const scaleY = cssH / DESIGN_H;
      view.scale = Math.min(scaleX, scaleY);
      view.offsetX = (cssW - DESIGN_W * view.scale) / 2;
      view.offsetY = (cssH - DESIGN_H * view.scale) / 2;

      applyViewTransform();
    }

    function applyViewTransform() {
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      ctx.setTransform(view.scale * view.dpr, 0, 0, view.scale * view.dpr,
                       view.offsetX * view.dpr, view.offsetY * view.dpr);
    }

    function clearFrame() {
      ctx.save();
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      ctx.clearRect(0, 0, gameArea.width, gameArea.height);
      ctx.restore();
      applyViewTransform();
    }

    // ====== ê³µìš© íŒì • ì²˜ë¦¬ ======
    function attemptHitOn(index) {
      if (index < 0 || index >= circles.length) return;
      const c = circles[index];
      const r = c.radius;
      let gained = 0;

      if (r > PERFECT_MIN && r < PERFECT_MAX) {
        gained = 100;                // 30 < r < 40
      } else if (Math.abs(r - TARGET) < 25) {
        gained = 50;                 // íƒ€ê¹ƒ Â±25
      } else {
        gained = 10;
      }

      score += gained;
      document.getElementById("score").innerText = score;
      circles.splice(index, 1); // í•´ë‹¹ ì› ì œê±°
    }

    // ====== ì…ë ¥: í‚¤ë³´ë“œ(PC í…ŒìŠ¤íŠ¸ìš©) ======
    function onKeyDown(e) {
      if (e.code !== "Space") return;
      if (circles.length === 0) return;
      attemptHitOn(0); // ê°€ì¥ ë¨¼ì € ëœ¬ ì›
    }

    // ====== ì…ë ¥: í„°ì¹˜/í´ë¦­(ëª¨ë°”ì¼ ìš°ì„ ) ======
    function screenToLogical(clientX, clientY) {
      const rect = gameArea.getBoundingClientRect();
      const cssX = clientX - rect.left;
      const cssY = clientY - rect.top;
      const x = (cssX - view.offsetX) / view.scale;
      const y = (cssY - view.offsetY) / view.scale;
      return { x, y };
    }

    function onPointerDown(e) {
      const { x, y } = screenToLogical(e.clientX, e.clientY);

      // í„°ì¹˜ ì§€ì ì—ì„œ ê°€ê¹Œìš´ ì› ì°¾ê¸° (ë°˜ê²½ TOUCH_HIT_RADIUS ì´ë‚´)
      let bestIdx = -1;
      let bestDist = Infinity;
      circles.forEach((c, i) => {
        const dx = x - c.x, dy = y - c.y;
        const dist = Math.hypot(dx, dy);
        if (dist <= TOUCH_HIT_RADIUS && dist < bestDist) {
          bestDist = dist;
          bestIdx = i;
        }
      });

      if (bestIdx !== -1) attemptHitOn(bestIdx);
    }

    // ====== ê²Œì„ ë£¨í”„ ======
    function updateGame() {
      clearFrame();

      // ì„ /í°íŠ¸ ë³´ì •
      const lw = 1 / view.scale;
      ctx.lineWidth = lw;
      ctx.font = `${Math.max(10, Math.floor(12 / view.scale))}px sans-serif`;

      // ì› ì—…ë°ì´íŠ¸ & ê·¸ë¦¬ê¸°
      circles.forEach(c => {
        c.radius += 0.5; // ì ˆë°˜ ì†ë„
        // ì‹¤ì œ ì›
        ctx.beginPath();
        ctx.setLineDash([]);
        ctx.strokeStyle = "black";
        ctx.arc(c.x, c.y, c.radius, 0, Math.PI * 2);
        ctx.stroke();

        // ë°˜ì§€ë¦„ ê°’ í‘œì‹œ(ê°€ê¹Œì´)
        ctx.fillText("r=" + Math.floor(c.radius), c.x + c.radius + 3, c.y);

        // í¼í™íŠ¸ ê¸°ì¤€ì„ (ê° ì˜¤ë¸Œì íŠ¸ ì£¼ìœ„ì— 1ê°œë§Œ) â€” ë¹¨ê°„ ì ì„ , ë°˜ì§€ë¦„ TARGET
        ctx.setLineDash([10 / view.scale, 7 / view.scale]);
        ctx.strokeStyle = "red";
        ctx.beginPath();
        ctx.arc(c.x, c.y, TARGET, 0, Math.PI * 2);
        ctx.stroke();
        ctx.setLineDash([]);
      });

      // rê°€ ë„ˆë¬´ ì»¤ì§„ ì› ì œê±° (60 ì´ˆê³¼ ì œê±°)
      circles = circles.filter(c => c.radius <= 60);

      requestAnimationFrame(updateGame);
    }

    // ====== í™”ë©´ êµ¬ì„± ======
    function startGame() {
      document.getElementById("content").innerHTML = `
        <div class="input-row">
          <label for="studentId">í•™ë²ˆ</label>
          <input id="studentId" type="text" placeholder="ì˜ˆ) 30123">
        </div>
        <div class="input-row">
          <label for="name">ì´ë¦„</label>
          <input id="name" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <div class="bar">
          <button onclick="gameStart()">ì…ë ¥ ì™„ë£Œ</button>
        </div>
      `;
    }

    function gameStart() {
      const id = (document.getElementById("studentId").value || "").trim();
      const name = (document.getElementById("name").value || "").trim();

      document.getElementById("content").innerHTML = `
        <canvas id="gameCanvas"></canvas>
        <p>ì ìˆ˜: <span id="score">0</span></p>
        <p>${id} ${name} ë‹˜, ì›í•˜ëŠ” íƒ€ì´ë°ì— ìŠ¤í° í•¨ìˆ˜ë¡œ ì›ì„ ìƒì„±í•˜ì„¸ìš”.
           (ëª¨ë°”ì¼: í„°ì¹˜ ê·¼ì²˜ ì› íŒì • / PC: Space)</p>
      `;

      gameArea = document.getElementById("gameCanvas");
      ctx = gameArea.getContext("2d");

      // â›” ìë™ ìŠ¤í° ì œê±°ë¨
      // gameInterval = setInterval(createCircle, 2000);

      resizeCanvas();
      requestAnimationFrame(updateGame);

      // ì…ë ¥ ë“±ë¡
      document.addEventListener("keydown", onKeyDown, { passive: true });
      gameArea.addEventListener("pointerdown", onPointerDown, { passive: true });

      // ë°˜ì‘í˜•
      window.addEventListener("resize", resizeCanvas);
      window.addEventListener("orientationchange", () => setTimeout(resizeCanvas, 50));
    }

    // ====== ë°ì´í„° / API ======
    // ì¢Œí‘œë¥¼ ë°›ì•„ ì› ìƒì„± (ê¸°ë³¸ê°’: ì¤‘ì•™)
    function createCircle(x = 300, y = 200) {
      circles.push({ x, y, radius: 5 }); // ì ˆë°˜ ì‹œì‘ ë°˜ì§€ë¦„
    }

    function showRanking() {
      document.getElementById("content").innerHTML = `<p>ë­í‚¹ ê¸°ëŠ¥ì€ ì¶”í›„ ì¶”ê°€ ì˜ˆì •</p>`;
    }
  </script>
</body>
</html>
